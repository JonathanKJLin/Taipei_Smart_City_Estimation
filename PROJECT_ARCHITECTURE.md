# 智慧城市估驗計價自動化驗算系統 - 架構介紹

## 📋 專案概述

本專案旨在為政府單位打造智慧化的估驗計價文件處理與驗算系統。透過結合 Azure Document Intelligence 與大型語言模型（LLM），實現估驗計價文件的自動化掃描、資料擷取、邏輯驗算與標準化輸出，大幅提升政府工程驗收作業效率與準確性。

---

## 🎯 核心目標

1. **自動化文件處理**：透過 AI 技術自動讀取、解析估驗計價相關文件
2. **智能驗算引擎**：建立 AI 規則引擎，執行金額加總、累計檢核、付款條件驗算
3. **資料標準化**：將非結構化文件轉換為標準化 JSON 格式
4. **持續學習優化**：透過回饋機制不斷強化 AI 模組準確度

---

## 🏗️ 系統架構概述

```
┌─────────────────────────────────────────────────────────────────┐
│                      估驗計價文件輸入層                            │
│  (PDF/Image格式的估驗計價單、付款明細、工程合約等)                    │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│              文件掃描與 ICR 層 (Azure DI)                         │
│  • 文件分類識別                                                   │
│  • 表格結構辨識                                                   │
│  • 文字、數字、欄位擷取（智能字元識別）                            │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│           自然語言處理與理解層 (GPT/LLM)                           │
│  • 欄位語義理解與對應                                              │
│  • 邏輯關聯識別（加總關係、條件關係）                                │
│  • 付款條件描述解析                                               │
│  • 數據標準化處理                                                 │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                  AI 規則引擎核心層                                │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│  │ 金額加總模組   │  │  累計檢核模組  │  │  條件驗算模組  │           │
│  └──────────────┘  └──────────────┘  └──────────────┘           │
│  • 自動執行驗算邏輯                                                │
│  • 錯誤偵測與標記                                                  │
│  • 規則動態學習與優化                                              │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│              資料輸出與回饋層                                     │
│  • 標準化 JSON 格式輸出                                           │
│  • 驗算結果報告                                                   │
│  • 異常標記與建議                                                 │
│  • 人工審核介面                                                   │
│  • 回饋機制（強化學習）                                           │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🔧 核心模組說明

### 1. **文件處理模組 (Document Processing Module)**
- **功能**：接收多格式文件（PDF、影像等），進行前處理
- **技術**：Azure Document Intelligence API
- **輸出**：結構化的文字、表格、欄位資訊（透過 ICR 智能字元識別技術）

### 2. **智能辨識模組 (Intelligent Recognition Module)**
- **功能**：
  - 文件類型自動分類（估驗計價單、付款明細、合約等）
  - 表格結構辨識
  - 關鍵欄位定位與擷取（使用 ICR 智能字元識別技術）
- **技術**：Azure Form Recognizer + Custom Models

### 3. **語義理解模組 (Semantic Understanding Module)**
- **功能**：
  - 欄位語義分析與對應
  - 邏輯關係識別（如「本期金額 = 累計金額 - 前期金額」）
  - 付款條件自然語言理解（如「工程完成30%後支付第二期款」）
- **技術**：Azure OpenAI GPT-4 / GPT-4o
- **方法**：Few-shot Learning + Prompt Engineering

### 4. **AI 規則引擎模組 (AI Rules Engine Module)**

#### 4.1 金額加總子模組
- 自動識別需加總的欄位
- 執行直式加總、橫式加總驗算
- 檢核小計、總計的正確性

#### 4.2 累計檢核子模組
- 追蹤各期累計金額
- 驗算「前期累計 + 本期金額 = 本期累計」
- 檢查是否超過合約總額

#### 4.3 付款條件驗算子模組
- 解析付款條件規則
- 驗證付款比例與實際進度的一致性
- 檢核付款金額計算的正確性

### 5. **資料標準化模組 (Data Standardization Module)**
- **功能**：將處理結果轉換為統一的 JSON Schema
- **輸出格式**：
```json
{
  "document_type": "估驗計價單",
  "contract_info": { ... },
  "payment_items": [ ... ],
  "validation_results": {
    "sum_check": { "status": "pass/fail", "details": [ ... ] },
    "accumulation_check": { ... },
    "payment_condition_check": { ... }
  },
  "confidence_scores": { ... }
}
```

### 6. **回饋與學習模組 (Feedback & Learning Module)**
- **功能**：
  - 收集人工審核結果
  - 標記錯誤案例
  - 自動更新規則庫
  - 持續優化 AI 模型
- **機制**：Human-in-the-loop (HITL) Learning

---

## 💻 技術棧

### 後端框架
- **Django 4.x**：Web 應用框架
- **Celery**：異步任務處理
- **Redis**：快取與任務佇列

### AI 與雲端服務
- **Azure Document Intelligence**：文件掃描與 ICR（智能字元識別）
- **Azure OpenAI Service**：GPT-4/GPT-4o for NLP
- **Azure Blob Storage**：文件儲存

### 資料處理
- **Python 3.10+**
- **Pandas**：資料處理與分析
- **PyPDF2 / pdf2image**：PDF 處理

### 資料庫
- **PostgreSQL**：主要資料庫
- **MongoDB (Optional)**：非結構化資料存儲

---

## 🔄 系統工作流程

```
1. 文件上傳
   ↓
2. Azure DI 掃描與 ICR（智能字元識別）
   ↓
3. 初步資料擷取（表格、文字、數字）
   ↓
4. GPT 語義分析與欄位對應
   ↓
5. 資料標準化處理
   ↓
6. AI 規則引擎驗算
   ├─ 金額加總檢查
   ├─ 累計金額檢核
   └─ 付款條件驗算
   ↓
7. 生成標準化 JSON 輸出
   ↓
8. 驗算結果報告與異常標記
   ↓
9. 人工審核與回饋
   ↓
10. AI 模組持續優化
```

---

## 📊 預期功能特色

### 自動化驗算功能
- ✅ 金額加總自動檢核
- ✅ 前後期累計金額驗證
- ✅ 付款條件合規性檢查
- ✅ 合約總額上限管控
- ✅ 異常項目自動標記

### 智能化特性
- 🧠 自動學習文件模板規則
- 🧠 適應不同格式的估驗計價單
- 🧠 動態調整驗算邏輯
- 🧠 提供改善建議

### 可擴展性
- 🔧 模組化設計，易於新增驗算規則
- 🔧 支援自定義 Schema
- 🔧 API 化服務，可整合既有系統

---

## 🎯 預期效益

| 項目 | 傳統人工作業 | AI 自動化系統 | 效益 |
|------|-------------|--------------|------|
| 處理時間 | 30-60 分鐘/件 | 3-5 分鐘/件 | **節省 85-90% 時間** |
| 錯誤率 | 5-10% | < 1% | **提升準確度** |
| 人力需求 | 高 | 低 | **降低人力成本** |
| 可追溯性 | 中 | 高 | **完整稽核軌跡** |

---

## 🔐 安全性與合規

- **資料加密**：傳輸與儲存全程加密
- **存取控制**：基於角色的權限管理（RBAC）
- **稽核日誌**：完整的操作記錄
- **隱私保護**：符合個資法與政府資安規範

---

## 📈 未來擴展方向

1. **多文件類型支援**：擴展至其他政府公文、合約文件
2. **智能報表生成**：自動產生統計分析報告
3. **預警系統**：預測潛在的付款風險或異常
4. **行動化應用**：開發移動端 App
5. **跨機關資料整合**：與其他政府系統串接

---

## 📝 開發階段規劃

### Phase 1: 基礎建設（1-2個月）
- 系統架構設計與環境建置
- Azure 服務整合
- 基礎文件處理功能

### Phase 2: 核心功能開發（2-3個月）
- AI 規則引擎開發
- 驗算邏輯實現
- 標準化輸出格式

### Phase 3: 優化與測試（1-2個月）
- 模型訓練與調優
- 大量測試與驗證
- 效能優化

### Phase 4: 上線與維運（持續）
- 系統部署
- 使用者培訓
- 持續優化與維護

---

## 👥 相關角色

- **專案經理**：整體專案規劃與管理
- **AI 工程師**：模型開發與優化
- **後端工程師**：系統架構與 API 開發
- **前端工程師**：使用者介面開發
- **領域專家**：估驗計價業務邏輯諮詢
- **測試工程師**：功能與效能測試

---

## 📞 聯絡資訊

**專案名稱**：智慧城市估驗計價自動化驗算系統  
**客戶單位**：台北市政府相關單位  
**開發團隊**：EY 安永聯合會計師事務所

---

*本文件為系統架構介紹，詳細技術規格與實作細節將於後續階段補充。*
